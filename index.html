<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµëª… ê²Œì‹œíŒ</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: #6c757d;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            margin-top: 8px;
            font-family: inherit;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        .header {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .post {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .post:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .post-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        .post-content {
            color: #555;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .comment {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        .revealed-tag {
            display: inline-block;
            background: #ff4444;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-left: 10px;
        }
        .known-identity {
            background: #4caf50;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            margin: 10px 0;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyAwW-4r34LivVZAB3Z4PtB_5BFeLFfS1s",
            authDomain: "ikmyeonggay.firebaseapp.com",
            databaseURL: "https://ikmyeonggay-default-rtdb.firebaseio.com",
            projectId: "ikmyeonggay",
            storageBucket: "ikmyeonggay.firebasestorage.app",
            messagingSenderId: "761175876587",
            appId: "1:761175876587:web:48b062812fc20d75b36fae",
            measurementId: "G-HDJB6TCZ2C"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 8ëª…ì˜ ê³„ì • (ì‹¤ì œë¡œëŠ” ë¹„ë°€ë²ˆí˜¸ í•´ì‹œë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ê°„ë‹¨í•˜ê²Œ base64)
        const ACCOUNTS = {
            'user1': { name: 'ê°•ì‹ ìš°', password: btoa('pass1234') },
            'user2': { name: 'ê¹€ëŒ€ì›…', password: btoa('pass2234') },
            'user3': { name: 'ê¹€ë¯¼ê¸°', password: btoa('pass3234') },
            'user4': { name: 'ê¹€ë¯¼í˜¸', password: btoa('pass4234') },
            'user5': { name: 'ì†¡ë¯¼ìˆ˜', password: btoa('pass5234') },
            'user6': { name: 'ì†ì„ì›…', password: btoa('pass6234') },
            'user7': { name: 'ê¹€ëª…ì§„', password: btoa('pass7234') },
            'user8': { name: 'ê¹€ì¶©ì—°', password: btoa('pass8234') }
        };

        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState({});
            const [posts, setPosts] = useState([]);
            const [showWriteModal, setShowWriteModal] = useState(false);
            const [showPostModal, setShowPostModal] = useState(false);
            const [showGuessModal, setShowGuessModal] = useState(false);
            const [showNicknameModal, setShowNicknameModal] = useState(false);
            const [selectedPost, setSelectedPost] = useState(null);
            const [todayGuess, setTodayGuess] = useState(null);

            // ë¡œê·¸ì¸ ì²´í¬
            useEffect(() => {
                const userId = localStorage.getItem('userId');
                if (userId && ACCOUNTS[userId]) {
                    setCurrentUser({ userId, ...ACCOUNTS[userId] });
                    loadUserData(userId);
                }
            }, []);

            // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
            const loadUserData = (userId) => {
                db.ref('users').on('value', snap => {
                    const data = snap.val() || {};
                    setUsers(data);
                });

                // ì˜¤ëŠ˜ì˜ ì§€ëª© í™•ì¸
                const today = new Date().toISOString().split('T')[0];
                db.ref(`guesses/${today}/${userId}`).once('value', snap => {
                    setTodayGuess(snap.val());
                });
            };

            // ê²Œì‹œê¸€ ë¡œë“œ
            useEffect(() => {
                db.ref('posts').on('value', snap => {
                    const data = snap.val();
                    if (data) {
                        const arr = Object.keys(data).map(k => ({
                            id: k,
                            ...data[k]
                        })).sort((a, b) => b.timestamp - a.timestamp);
                        setPosts(arr);
                    }
                });
            }, []);

            // ë¡œê·¸ì¸
            const login = (userId, password) => {
                if (!ACCOUNTS[userId]) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤!');
                    return;
                }
                if (ACCOUNTS[userId].password !== btoa(password)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!');
                    return;
                }

                localStorage.setItem('userId', userId);
                setCurrentUser({ userId, ...ACCOUNTS[userId] });
                loadUserData(userId);

                // ì‚¬ìš©ì ì´ˆê¸°í™” (ì—†ìœ¼ë©´ ìƒì„±)
                db.ref(`users/${userId}`).once('value', snap => {
                    if (!snap.val()) {
                        db.ref(`users/${userId}`).set({
                            name: ACCOUNTS[userId].name,
                            nickname: ACCOUNTS[userId].name,
                            nicknameChangedAt: 0,
                            revealedTo: [],
                            isPubliclyRevealed: false
                        });
                    }
                });
            };

            // ë¡œê·¸ì•„ì›ƒ
            const logout = () => {
                localStorage.removeItem('userId');
                setCurrentUser(null);
            };

            // ë‹‰ë„¤ì„ ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            const canChangeNickname = () => {
                if (!currentUser || !users[currentUser.userId]) return false;
                const lastChanged = users[currentUser.userId].nicknameChangedAt || 0;
                const now = Date.now();
                const koreaTime = new Date(now + (9 * 60 * 60 * 1000));
                const todayMidnight = new Date(koreaTime.getFullYear(), koreaTime.getMonth(), koreaTime.getDate()).getTime() - (9 * 60 * 60 * 1000);
                return lastChanged < todayMidnight;
            };

            // ë‹‰ë„¤ì„ ë³€ê²½
            const changeNickname = (newNickname) => {
                if (!newNickname.trim()) {
                    alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }
                db.ref(`users/${currentUser.userId}`).update({
                    nickname: newNickname.trim(),
                    nicknameChangedAt: Date.now()
                });
                setShowNicknameModal(false);
                alert('ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };

            // ì§€ëª©í•˜ê¸°
            const makeGuess = (targetUserId) => {
                if (targetUserId === currentUser.userId) {
                    alert('ìê¸° ìì‹ ì€ ì§€ëª©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }

                const today = new Date().toISOString().split('T')[0];
                const targetName = ACCOUNTS[targetUserId].name;
                const selectedUser = document.getElementById('guessSelect').value;

                if (!selectedUser) {
                    alert('ì¶”ì¸¡í•  ì‚¬ëŒì„ ì„ íƒí•˜ì„¸ìš”!');
                    return;
                }

                const correct = selectedUser === targetUserId;

                // ì§€ëª© ê¸°ë¡
                db.ref(`guesses/${today}/${currentUser.userId}`).set({
                    targetId: targetUserId,
                    guessedId: selectedUser,
                    correct: correct,
                    timestamp: Date.now()
                });

                if (correct) {
                    // ë§ì¶¤: íƒ€ê²Ÿì˜ ì •ì²´ë¥¼ ë‚˜ì—ê²Œë§Œ ê³µê°œ
                    db.ref(`users/${targetUserId}/revealedTo`).once('value', snap => {
                        const revealedTo = snap.val() || [];
                        if (!revealedTo.includes(currentUser.userId)) {
                            revealedTo.push(currentUser.userId);
                            db.ref(`users/${targetUserId}/revealedTo`).set(revealedTo);
                        }
                    });
                    alert(`ì •ë‹µì…ë‹ˆë‹¤! ${ACCOUNTS[targetUserId].name}ë‹˜ì˜ ì •ì²´ë¥¼ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                } else {
                    // í‹€ë¦¼: ë‚´ ì •ì²´ë¥¼ ì „ì²´ ê³µê°œ
                    db.ref(`users/${currentUser.userId}`).update({
                        isPubliclyRevealed: true
                    });
                    alert('í‹€ë ¸ìŠµë‹ˆë‹¤! ë‹¹ì‹ ì˜ ì •ì²´ê°€ ëª¨ë‘ì—ê²Œ ê³µê°œë©ë‹ˆë‹¤!');
                }

                setTodayGuess({ targetId: targetUserId, guessedId: selectedUser, correct });
                setShowGuessModal(false);
            };

            // ê²Œì‹œê¸€ ì‘ì„±
            const writePost = (title, content) => {
                if (!title.trim() || !content.trim()) {
                    alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }

                const postId = Date.now().toString();
                const currentNickname = users[currentUser.userId]?.nickname || currentUser.name;

                db.ref(`posts/${postId}`).set({
                    authorId: currentUser.userId,
                    nickname: currentNickname,
                    title: title.trim(),
                    content: content.trim(),
                    timestamp: Date.now()
                });

                setShowWriteModal(false);
                alert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };

            // ëŒ“ê¸€ ì‘ì„±
            const writeComment = (postId, content) => {
                if (!content.trim()) {
                    alert('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!');
                    return;
                }

                const commentId = Date.now().toString();
                const currentNickname = users[currentUser.userId]?.nickname || currentUser.name;

                db.ref(`posts/${postId}/comments/${commentId}`).set({
                    authorId: currentUser.userId,
                    nickname: currentNickname,
                    content: content.trim(),
                    timestamp: Date.now()
                });

                alert('ëŒ“ê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
            };

            // ë‚´ê°€ ì•Œê³  ìˆëŠ” ì •ì²´ë“¤
            const getKnownIdentities = () => {
                if (!currentUser) return [];
                const known = [];
                Object.keys(users).forEach(uid => {
                    const user = users[uid];
                    if (user.isPubliclyRevealed) {
                        known.push({ userId: uid, name: ACCOUNTS[uid].name, type: 'public' });
                    } else if (user.revealedTo && user.revealedTo.includes(currentUser.userId)) {
                        known.push({ userId: uid, name: ACCOUNTS[uid].name, type: 'private' });
                    }
                });
                return known;
            };

            if (!currentUser) {
                return <LoginScreen onLogin={login} />;
            }

            const myNickname = users[currentUser.userId]?.nickname || currentUser.name;
            const knownIdentities = getKnownIdentities();

            return (
                <div className="container">
                    <div className="header">
                        <div>
                            <h2>ìµëª… ê²Œì‹œíŒ ğŸ­</h2>
                            <p style={{color: '#666', marginTop: '5px'}}>
                                ë‚´ ë‹‰ë„¤ì„: <strong>{myNickname}</strong>
                                {users[currentUser.userId]?.isPubliclyRevealed && 
                                    <span className="revealed-tag">ì •ì²´ ê³µê°œë¨</span>
                                }
                            </p>
                        </div>
                        <div>
                            <button className="btn" onClick={() => setShowNicknameModal(true)} disabled={!canChangeNickname()}>
                                {canChangeNickname() ? 'ë‹‰ë„¤ì„ ë³€ê²½' : 'ì˜¤ëŠ˜ ë³€ê²½ ì™„ë£Œ'}
                            </button>
                            <button className="btn btn-secondary" onClick={() => setShowGuessModal(true)} disabled={!!todayGuess}>
                                {todayGuess ? 'ì˜¤ëŠ˜ ì§€ëª© ì™„ë£Œ' : 'ì§€ëª©í•˜ê¸°'}
                            </button>
                            <button className="btn btn-secondary" onClick={logout}>
                                ë¡œê·¸ì•„ì›ƒ
                            </button>
                        </div>
                    </div>

                    {knownIdentities.length > 0 && (
                        <div className="card">
                            <h3 style={{marginBottom: '15px'}}>ì•Œê³  ìˆëŠ” ì •ì²´ë“¤ ğŸ‘€</h3>
                            {knownIdentities.map(k => (
                                <div key={k.userId} className="known-identity" style={{background: k.type === 'public' ? '#ff4444' : '#4caf50'}}>
                                    {users[k.userId]?.nickname || k.name} = <strong>{k.name}</strong>
                                    {k.type === 'public' ? ' (ì „ì²´ ê³µê°œ)' : ' (ë‚˜ë§Œ ì•Œê³  ìˆìŒ)'}
                                </div>
                            ))}
                        </div>
                    )}

                    <button className="btn" onClick={() => setShowWriteModal(true)}>
                        âœï¸ ìƒˆ ê¸€ ì“°ê¸°
                    </button>

                    <div style={{marginTop: '20px'}}>
                        {posts.map(post => (
                            <div key={post.id} className="post" onClick={() => { setSelectedPost(post); setShowPostModal(true); }}>
                                <div className="post-title">{post.title}</div>
                                <div className="post-meta">
                                    ì‘ì„±ì: {post.nickname} | {new Date(post.timestamp).toLocaleString('ko-KR')}
                                </div>
                                <div className="post-content" style={{maxHeight: '60px', overflow: 'hidden'}}>
                                    {post.content}
                                </div>
                            </div>
                        ))}
                    </div>

                    {showWriteModal && <WriteModal onClose={() => setShowWriteModal(false)} onSubmit={writePost} />}
                    {showPostModal && <PostModal post={selectedPost} onClose={() => setShowPostModal(false)} onComment={writeComment} users={users} currentUserId={currentUser.userId} />}
                    {showGuessModal && <GuessModal onClose={() => setShowGuessModal(false)} onGuess={makeGuess} accounts={ACCOUNTS} currentUserId={currentUser.userId} users={users} />}
                    {showNicknameModal && <NicknameModal onClose={() => setShowNicknameModal(false)} onSubmit={changeNickname} currentNickname={myNickname} />}
                </div>
            );
        }

        function LoginScreen({ onLogin }) {
            const [userId, setUserId] = useState('');
            const [password, setPassword] = useState('');

            return (
                <div className="container" style={{paddingTop: '100px'}}>
                    <div className="card" style={{maxWidth: '400px', margin: '0 auto'}}>
                        <h1 style={{textAlign: 'center', marginBottom: '30px', color: '#667eea'}}>ìµëª… ê²Œì‹œíŒ ğŸ­</h1>
                        
                        <div className="info-box">
                            <h4>ê³„ì • ì •ë³´</h4>
                            <p style={{fontSize: '0.9rem', marginTop: '10px', lineHeight: '1.6'}}>
                                user1 (ê°•ì‹ ìš°) - pass1234<br/>
                                user2 (ê¹€ëŒ€ì›…) - pass2234<br/>
                                user3 (ê¹€ë¯¼ê¸°) - pass3234<br/>
                                user4 (ê¹€ë¯¼í˜¸) - pass4234<br/>
                                user5 (ì†¡ë¯¼ìˆ˜) - pass5234<br/>
                                user6 (ì†ì„ì›…) - pass6234<br/>
                                user7 (ê¹€ëª…ì§„) - pass7234<br/>
                                user8 (ê¹€ì¶©ì—°) - pass8234
                            </p>
                        </div>

                        <label>ì•„ì´ë””</label>
                        <input 
                            type="text" 
                            placeholder="ì˜ˆ: user1"
                            value={userId}
                            onChange={e => setUserId(e.target.value)}
                        />

                        <label style={{marginTop: '15px'}}>ë¹„ë°€ë²ˆí˜¸</label>
                        <input 
                            type="password"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                            value={password}
                            onChange={e => setPassword(e.target.value)}
                            onKeyPress={e => e.key === 'Enter' && onLogin(userId, password)}
                        />

                        <button className="btn" onClick={() => onLogin(userId, password)}>
                            ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>
            );
        }

        function WriteModal({ onClose, onSubmit }) {
            const [title, setTitle] = useState('');
            const [content, setContent] = useState('');

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h2 style={{marginBottom: '20px'}}>ìƒˆ ê¸€ ì“°ê¸°</h2>
                        
                        <label>ì œëª©</label>
                        <input 
                            type="text"
                            placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                            value={title}
                            onChange={e => setTitle(e.target.value)}
                        />

                        <label style={{marginTop: '15px'}}>ë‚´ìš©</label>
                        <textarea 
                            placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                            value={content}
                            onChange={e => setContent(e.target.value)}
                            style={{minHeight: '200px'}}
                        />

                        <button className="btn" onClick={() => onSubmit(title, content)}>
                            ì‘ì„±í•˜ê¸°
                        </button>
                        <button className="btn btn-secondary" onClick={onClose}>
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            );
        }

        function PostModal({ post, onClose, onComment, users, currentUserId }) {
            const [comment, setComment] = useState('');
            const comments = post.comments ? Object.keys(post.comments).map(k => ({
                id: k,
                ...post.comments[k]
            })).sort((a, b) => a.timestamp - b.timestamp) : [];

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h2 style={{marginBottom: '10px'}}>{post.title}</h2>
                        <div className="post-meta" style={{marginBottom: '20px'}}>
                            ì‘ì„±ì: {post.nickname} | {new Date(post.timestamp).toLocaleString('ko-KR')}
                        </div>
                        <div className="post-content" style={{marginBottom: '30px'}}>
                            {post.content}
                        </div>

                        <h3 style={{marginBottom: '15px'}}>ëŒ“ê¸€ ({comments.length})</h3>
                        
                        {comments.map(c => (
                            <div key={c.id} className="comment">
                                <div style={{fontWeight: 'bold', marginBottom: '5px'}}>
                                    {c.nickname}
                                    <span style={{color: '#999', fontWeight: 'normal', fontSize: '0.85rem', marginLeft: '10px'}}>
                                        {new Date(c.timestamp).toLocaleString('ko-KR')}
                                    </span>
                                </div>
                                <div style={{whiteSpace: 'pre-wrap'}}>{c.content}</div>
                            </div>
                        ))}

                        <textarea 
                            placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"
                            value={comment}
                            onChange={e => setComment(e.target.value)}
                            style={{marginTop: '20px'}}
                        />
                        <button className="btn" onClick={() => { onComment(post.id, comment); setComment(''); }}>
                            ëŒ“ê¸€ ì‘ì„±
                        </button>
                        <button className="btn btn-secondary" onClick={onClose}>
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            );
        }

        function GuessModal({ onClose, onGuess, accounts, currentUserId, users }) {
            const [targetUser, setTargetUser] = useState('');
            const otherUsers = Object.keys(accounts).filter(u => u !== currentUserId);

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h2 style={{marginBottom: '20px'}}>ëˆ„êµ°ê°€ì˜ ì •ì²´ë¥¼ ì§€ëª©í•˜ê¸° ğŸ¯</h2>
                        
                        <div className="warning-box">
                            <strong>âš ï¸ ì£¼ì˜!</strong><br/>
                            â€¢ í•˜ë£¨ì— í•œ ë²ˆë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤<br/>
                            â€¢ ë§ì¶”ë©´: ìƒëŒ€ë°©ì˜ ì •ì²´ë¥¼ ì•Œê²Œ ë©ë‹ˆë‹¤<br/>
                            â€¢ í‹€ë¦¬ë©´: ë‹¹ì‹ ì˜ ì •ì²´ê°€ ëª¨ë‘ì—ê²Œ ê³µê°œë©ë‹ˆë‹¤!
                        </div>

                        <label>ì§€ëª©í•  ì‚¬ëŒì˜ ë‹‰ë„¤ì„</label>
                        <select value={targetUser} onChange={e => setTargetUser(e.target.value)}>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            {otherUsers.map(uid => {
                                const nickname = users[uid]?.nickname || accounts[uid].name;
                                return <option key={uid} value={uid}>{nickname}</option>;
                            })}
                        </select>

                        {targetUser && (
                            <>
                                <label style={{marginTop: '15px'}}>ì´ ì‚¬ëŒì˜ ì‹¤ì œ ì •ì²´ëŠ”?</label>
                                <select id="guessSelect">
                                    <option value="">ì¶”ì¸¡í•˜ì„¸ìš”</option>
                                    {otherUsers.map(uid => (
                                        <option key={uid} value={uid}>{accounts[uid].name}</option>
                                    ))}
                                </select>

                                <button className="btn" onClick={() => onGuess(targetUser)}>
                                    ì§€ëª©í•˜ê¸°
                                </button>
                            </>
                        )}
                        
                        <button className="btn btn-secondary" onClick={onClose}>
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            );
        }

        function NicknameModal({ onClose, onSubmit, currentNickname }) {
            const [nickname, setNickname] = useState(currentNickname);

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <h2 style={{marginBottom: '20px'}}>ë‹‰ë„¤ì„ ë³€ê²½</h2>
                        
                        <div className="info-box">
                            ë‹‰ë„¤ì„ì€ ìì •ë§ˆë‹¤ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>

                        <label>ìƒˆ ë‹‰ë„¤ì„</label>
                        <input 
                            type="text"
                            placeholder="ìƒˆ ë‹‰ë„¤ì„ ì…ë ¥"
                            value={nickname}
                            onChange={e => setNickname(e.target.value)}
                            onKeyPress={e => e.key === 'Enter' && onSubmit(nickname)}
                        />

                        <button className="btn" onClick={() => onSubmit(nickname)}>
                            ë³€ê²½í•˜ê¸°
                        </button>
                        <button className="btn btn-secondary" onClick={onClose}>
                            ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
